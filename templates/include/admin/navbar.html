{% load static %}
{% load custom_filters %}

<nav class="navbar navbar-static-top" role="navigation">
    <a href="#" class="navbar-btn sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </a>

    <div class="navbar-right">
        <ul class="nav navbar-nav">

            <!-- Notifications -->
            <li class="dropdown notifications-menu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    <i class="fa fa-bell"></i>
                    {% if notifications %}
                        {% with notifications|dictsort:"lu"|length as non_lues %}
                            <span class="label label-warning">{{ non_lues }}</span>
                        {% endwith %}
                    {% endif %}
                </a>
                <ul class="dropdown-menu">
                    <li class="header">
                        {% if notifications %}Vous avez {{ notifications|length }} notifications{% else %}Aucune notification{% endif %}
                    </li>
                    <li>
                        <ul class="menu">
                            {% for notif in notifications %}
                                <li class="{% if not notif.lu %}bg-light{% endif %}">
                                    <a href="{% if request.user|has_attr:'employer' %}{% url 'notifications:marquer_lue' notif.id %}{% else %}#{% endif %}">
                                        <i class="fa fa-info-circle text-info"></i>
                                        {{ notif.message|truncatechars:50|default:"-" }}
                                        <br>
                                        <small class="text-muted">{{ notif.date_notification|date:"d/m/Y H:i"|default:"-" }}</small>
                                    </a>
                                </li>
                            {% empty %}
                                <li><a>Aucune notification</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% if request.user|has_attr:"employer" %}
                        <li class="footer">
                            <a href="{% url 'notifications:liste_notifications' request.user.employer.id %}">Voir toutes</a>
                        </li>
                    {% endif %}
                </ul>
            </li>

            <!-- User Account -->
            <li class="dropdown user user-menu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    <i class="glyphicon glyphicon-user"></i>
                    <span>{{ request.user.get_full_name|default:request.user.username }} <i class="caret"></i></span>
                </a>
                <ul class="dropdown-menu">
                    <li class="user-header bg-light-blue">
                                        {% if user.photo_utilisateur %}
                                    <img src="{{ user.photo_utilisateur.url }}" class="img-circle" alt="User Image" />
                                {% else %}
                                    <img src="{% static 'img/avatar3.png' %}" class="img-circle" alt="User Image" />
                                {% endif %}
                        <p>
                            {{ request.user.get_full_name|default:request.user.username }}
                            {% if request.user|has_attr:"profile" %}
                                - {{ request.user.profile.role|default:"Utilisateur" }}
                            {% endif %}
                            <small>Membre depuis {{ request.user.date_joined|date:"M. Y" }}</small>
                        </p>
                    </li>
                    <li class="user-footer">
                
                        <div class="pull-right">
                            <a href="{% url 'gestionUtilisateur:deconnexion_utilisateur' %}" class="btn btn-default btn-flat">DÃ©connexion</a>
                        </div>
                    </li>
                </ul>
            </li>

        </ul>
    </div>
</nav>
