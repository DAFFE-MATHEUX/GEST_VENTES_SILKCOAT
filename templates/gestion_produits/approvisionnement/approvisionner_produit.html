{% extends 'admin.html' %}
{% block contents %}

<h2 class="mb-3">Approvisionnement des produits</h2>
<hr>

<form method="post">
  {% csrf_token %}

  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Produit</th>
          <th>Catégorie</th>
          <th>Stock actuel</th>
          <th>Quantité à ajouter</th>
        </tr>
      </thead>

      <tbody>
        {% for p in produits_data %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ p.produit.desgprod }}</td>
          <td>{{ p.produit.categorie.desgcategorie }}</td>
          <td>
            <span class="badge bg-info">{{ p.stock }}</span>
          </td>
          <td>
            <input type="text"
                   name="quantite_{{ p.produit.id }}"
                   class="form-control input-number"
                   value="0">
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-danger">
            Aucun produit disponible
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="mt-3">
      <button type="submit" class="btn btn-success">
        ✔ Valider l’approvisionnement
      </button>
    </div>
  </div>
</form>

<script>
// Bloquer les caractères non numériques pour tous les champs avec class input-number
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('.input-number');
    inputs.forEach(input => {
        input.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    });
});
</script>

{% endblock %}
