{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Facture - {{ entreprise.nom_entreprise }}</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">

    <style>
        body {
            background: #f8f9fa;
            font-family: "Poppins", sans-serif;
            color: #222;
        }

        .recu-container {
            background: white;
            max-width: 950px;
            margin: 40px auto;
            padding: 30px 40px;
            border: 1px solid #000;
        }

        /* ================= ENTÊTE ================= */
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center; /* important pour le logo */
            padding-bottom: 15px;
            margin-bottom: 10px;
        }

        .header-left,
        .header-right {
            font-size: 13px;
            line-height: 1.6;
            width: 30%;
        }

        .header-center {
            text-align: center;
            width: 40%;
        }

        .header-center h2 {
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 10px;
            font-size: 18px;
        }

        /* LOGO AGRANDI */
        .logo {
            max-width: 220px;
            max-height: 180px;
            object-fit: contain;
        }

        /* ================= TITRE ================= */
        .facture-title {
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            border: 2px solid #000;
            padding: 8px;
            margin: 20px 0;
        }

        /* ================= TABLEAUX ================= */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        th, td {
            border: 1px solid #000;
            padding: 7px;
            font-size: 13px;
        }

        th {
            background: #e9ecef;
        }

        .total-box {
            font-size: 16px;
            font-weight: bold;
            text-align: right;
        }

        /* ================= FOOTER ================= */
        .footer {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 50px;
            border-top: 1px solid #000;
            padding-top: 15px;
        }

        .footer-left {
            font-size: 13px;
            line-height: 1.6;
        }

        .footer-left img {
            max-height: 70px;
            margin-bottom: 8px;
        }

        .footer-right {
            text-align: right;
            font-size: 13px;
        }

        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            body {
                background: white;
            }
        }
    </style>
</head>

<body>

<div class="recu-container">

    <!-- ================= ENTÊTE ENTREPRISE ================= -->
    <div class="header-top">

        <div class="header-left">
            <strong>{{ entreprise.nom_entreprise|upper }}</strong><br>
            {{ entreprise.adresse|default:"" }}<br>
            Tél : {{ entreprise.contact1|default:"-" }}<br>
            {% if entreprise.contact2 %}
                {{ entreprise.contact2 }}<br>
            {% endif %}
            Email : {{ entreprise.email|default:"-" }}
        </div>

        <div class="header-center">
            {% if entreprise.logo %}
                <img src="{{ entreprise.logo.url }}" class="logo"><br>
            {% endif %}
            <h2>{{ entreprise.nom_entreprise }}</h2>
        </div>

        <div class="header-right text-right">
            {% if qr_code_base64 %}
                <img src="data:image/png;base64,{{ qr_code_base64 }}" width="90" height="90">
            {% endif %}
        </div>

    </div>

    <!-- ================= TITRE ================= -->
    <div class="facture-title">
        FACTURE DE VENTES
    </div>

    <!-- ================= INFOS FACTURE ================= -->
    <table>
        <tr>
            <th>Numéro de la Facture</th>
            <td>{{ vente.code }}</td>
            <th>Date</th>
            <td>{{ vente.date_vente|date:"d/m/Y H:i" }}</td>
        </tr>
        <tr>
            <th>Vendu par</th>
            <td>{{ vente.utilisateur.get_full_name }}</td>
            <th>Mode de paiement</th>
            <td>Comptant</td>
        </tr>
    </table>

    <!-- ================= CLIENT ================= -->
    <table>
        <tr>
            <th>Nom du client</th>
            <td>{{ vente.nom_complet_client }}</td>
        </tr>
        <tr>
            <th>Adresse</th>
            <td>{{ vente.adresseclt_client|default:"-" }}</td>
        </tr>
        <tr>
            <th>Téléphone</th>
            <td>{{ vente.telclt_client|default:"-" }}</td>
        </tr>
    </table>

    <!-- ================= PRODUITS ================= -->
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Catégorie</th>
                <th>Désignation</th>
                <th>Qté</th>
                <th>PU (GNF)</th>
                <th>Réduction</th>
                <th>Total (GNF)</th>
            </tr>
        </thead>
        <tbody>
            {% for l in lignes %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ l.produit.categorie.desgcategorie }}</td>
                <td>{{ l.produit.desgprod }}</td>
                <td class="text-center">{{ l.quantite }}</td>
                <td class="text-end">{{ l.prix|floatformat:0 }}</td>
                <td class="text-end">{{ l.montant_reduction|floatformat:0 }}</td>
                <td class="text-end">{{ l.sous_total|floatformat:0 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- ================= TOTAL & BANQUE ================= -->
    <table>
        <tr>
            <td>
                <img src="{% static 'img/logo_uba.jpg' %}" alt="Logo UBA" width="70"><br>
                <strong>LES PRODUITS SONT D’ORIGINE TURQUE</strong><br>
                <strong>LES PRODUITS SONT PRODUITS EN GUINÉE</strong>
            </td>
        </tr>
        <tr>
            <td class="total-box">
                TOTAL À PAYER : {{ total|floatformat:0 }} GNF
            </td>
        </tr>
    </table>

    <!-- ================= FOOTER ================= -->
    <div class="footer">

        <div class="footer-left">
            <!-- réservé si besoin futur -->
                <strong>INTITULÉ DE COMPTE :</strong> ITRACO BTP SARLU<br>
                <strong>COMPTE :</strong> 60011030023275<br>
                <strong>CLÉ RIB :</strong> 56<br>
        </div>


        <div class="footer-right">
            <strong>Le Responsable</strong><br>
            {{ entreprise.nom_entreprise }}<br>
            {{ today|date:"d/m/Y" }}
        </div>

    </div>

</div>

</body>
</html>
