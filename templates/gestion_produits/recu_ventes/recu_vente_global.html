{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Facture - {{ entreprise.nom_entreprise }}</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <style>
        body {
            background: #f8f9fa;
            font-family: "Poppins", sans-serif;
            color: #222;
        }

        .recu-container {
            background: white;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px 25px;
            border: 1px solid #000;
        }

        /* ENTÊTE */
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .header-left, .header-right {
            font-size: 12px;
            line-height: 1.4;
            width: 30%;
        }

        .header-center {
            text-align: center;
            width: 40%;
        }

        .header-center h2 {
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 5px;
            font-size: 16px;
        }

        .logo {
            max-width: 180px;
            max-height: 150px;
            object-fit: contain;
        }

        /* TITRE */
        .facture-title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            border: 2px solid #000;
            padding: 6px;
            margin: 15px 0;
        }

        /* TABLEAUX */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            table-layout: fixed;
        }

        th, td {
            border: 1px solid #000;
            padding: 4px 5px;
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        th {
            background: #e9ecef;
        }

        td.text-center { text-align: center; }
        td.text-end { text-align: right; }

        tfoot tr {
            font-weight: bold;
            background-color: #f1f3f5;
        }

        .total-box {
            font-size: 16px;
            font-weight: bold;
            text-align: right;
            color: #0d6efd;
        }

        /* FOOTER */
        .footer {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 30px;
            border-top: 1px solid #000;
            padding-top: 10px;
            font-size: 12px;
            line-height: 1.4;
        }

        .footer-left img {
            max-height: 60px;
            margin-bottom: 5px;
        }

        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            body {
                background: white;
            }

            tr { page-break-inside: avoid; }
            table { page-break-after: auto; }
        }
    </style>
</head>

<body>
<div class="recu-container">

    <!-- ENTÊTE -->
    <div class="header-top">
        <div class="header-left">
            <strong>{{ entreprise.nom_entreprise|upper }}</strong><br>
            {{ entreprise.adresse|default:"" }}<br>
            Tél : {{ entreprise.contact1|default:"-" }}<br>
            {% if entreprise.contact2 %}{{ entreprise.contact2 }}<br>{% endif %}
            Email : {{ entreprise.email|default:"-" }}
        </div>

        <div class="header-center">
            {% if entreprise.logo %}
                <img src="{{ entreprise.logo.url }}" class="logo"><br>
            {% endif %}
            <h2>{{ entreprise.nom_entreprise }}</h2>
        </div>

        <div class="header-right text-right">
            {% if qr_code_base64 %}
                <img src="data:image/png;base64,{{ qr_code_base64 }}" width="80" height="80">
            {% endif %}
        </div>
    </div>

    <!-- TITRE -->
    <div class="facture-title">FACTURE DE VENTES</div>

    <!-- INFOS FACTURE -->
    <table>
        <tr>
            <th>Numéro de la Facture</th>
            <td>{{ vente.code }}</td>
            <th>Date</th>
            <td>{{ vente.date_vente|date:"d/m/Y H:i" }}</td>
        </tr>
        <tr>
            <th>Vendu par</th>
            <td>{{ vente.utilisateur.get_full_name }}</td>
            <th>Mode de paiement</th>
            <td>Comptant</td>
        </tr>
    </table>

    <!-- CLIENT -->
    <table>
        <tr>
            <th>Nom du client</th>
            <td>{{ vente.nom_complet_client }}</td>
        </tr>
        <tr>
            <th>Adresse</th>
            <td>{{ vente.adresseclt_client|default:"-" }}</td>
        </tr>
        <tr>
            <th>Téléphone</th>
            <td>{{ vente.telclt_client|default:"-" }}</td>
        </tr>
    </table>

    <!-- PRODUITS -->
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Catégorie</th>
                <th>Désignation</th>
                <th>Qté</th>
                <th>PU (GNF)</th>
                <th>Réduction</th>
                <th>Total (GNF)</th>
            </tr>
        </thead>
        <tbody>
            {% for l in lignes %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ l.produit.categorie.desgcategorie }}</td>
                <td>{{ l.produit.desgprod }}</td>
                <td class="text-center">{{ l.quantite }}</td>
                <td class="text-end">{{ l.prix|floatformat:0 }}</td>
                <td class="text-end">{{ l.montant_reduction|floatformat:0 }}</td>
                <td class="text-end">{{ l.sous_total|floatformat:0 }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-center">Totaux</th>
                <th class="text-center">{{ total_quantite|floatformat:0 }}</th>
                <th class="text-center">-</th>
                <th class="text-end">{{ total_reduction|floatformat:0 }} GNF</th>
                <th class="text-end">{{ total|floatformat:0 }} GNF</th>
            </tr>
        </tfoot>
    </table>

    <!-- TOTAL & BANQUE -->
    <table>
        <tr>
            <td>
                <strong>LES PRODUITS SONT D’ORIGINE TURQUE</strong><br>
                <strong>LES PRODUITS SONT PRODUITS EN GUINÉE</strong>
            </td>
        </tr>
        <tr>
            <td class="total-box">TOTAL À PAYER : {{ total|floatformat:0 }} GNF</td>
        </tr>
    </table>

    <!-- FOOTER -->
    <div class="footer">
        <div class="footer-left">
            <img src="{% static 'img/logo_uba.jpg' %}" alt="Logo UBA" width="60"><br>
            <strong>INTITULÉ DE COMPTE :</strong> ITRACO BTP SARLU<br>
            <strong>COMPTE :</strong> 60011030023275
            <strong>CLÉ RIB :</strong> 56
        </div>

        <div class="footer-right">
            <strong>Le Responsable</strong><br>
            {{ entreprise.nom_entreprise }}<br>
            {{ today|date:"d/m/Y" }}
        </div>
    </div>

</div>
</body>
</html>
