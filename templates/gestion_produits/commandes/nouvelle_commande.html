{% extends 'admin.html' %}
{% block contents %}

<h2>GESTION DES COMMANDES</h2>
<hr>

{% if messages %}
  {% for m in messages %}
    <div class="alert alert-{{ m.tags }}">{{ m }}</div>
  {% endfor %}
{% endif %}

<form method="post">
  {% csrf_token %}

  <!-- Fournisseur -->
  <div class="form-group">
    <label>Nom complet du Fournisseur</label>
    <input type="text" class="form-control" name="nom_complet_fournisseur" required>
  </div>
  <div class="form-group">
    <label>Téléphone</label>
    <input type="text" class="form-control" name="telephone_fournisseur" required>
  </div>
  <div class="form-group">
    <label>Adresse</label>
    <input type="text" class="form-control" name="adresse_fournisseur" required>
  </div>

  <!-- Recherche -->
  <div class="mb-3">
    <input id="search" class="form-control" placeholder="Rechercher produit (nom ou catégorie)">
  </div>

  <!-- Table Produits -->
  <table class="table table-bordered" id="table-produits">
    <thead class="table-dark">
      <tr>
        <th>Catégorie</th>
        <th>Produit</th>
        <th>Stock Entrepôt</th>
        <th>Seuil Entrepôt</th>
        <th>Stock Magasin</th>
        <th>Seuil Magasin</th>
        <th>Quantité à commander</th>
      </tr>
    </thead>
    <tbody>
      {% for p in produits_data %}
      <tr class="produit-row">
        <td>{{ p.produit.categorie.desgcategorie }}</td>
        <td>{{ p.produit.desgprod }}</td>
        <td>{{ p.stock_entrepot }}</td>
        <td>{{ p.seuil_entrepot }}</td>
        <td>{{ p.stock_magasin }}</td>
        <td>{{ p.seuil_magasin }}</td>
        <td>
          <input type="number" name="quantite[]" class="form-control qte" min="0" max="{{ p.stock_entrepot }}" value="0">
          <input type="hidden" name="produit_id[]" value="{{ p.produit.id }}">
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="text-center">Aucun produit disponible.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <button class="btn btn-success mt-3">Valider la commande</button>
</form>

<script>
document.getElementById("search").addEventListener("input", function () {
  const q = this.value.toLowerCase();
  document.querySelectorAll(".produit-row").forEach(row => {
    row.style.display = row.textContent.toLowerCase().includes(q) ? "" : "none";
  });
});
</script>

{% endblock %}
