{% extends 'admin.html' %}
{% block contents %}

<h2 class="mb-3">üì¶ R√©ception des commandes</h2>
<hr>

<form method="post">
  {% csrf_token %}
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Commande</th>
          <th>Produit</th>
          <th>Fournisseur</th>
          <th>Qt√© command√©e</th>
          <th>D√©j√† livr√©e</th>
          <th>Restante</th>
          <th>Destination</th>
          <th>Qt√© Magasin</th>
          <th>Qt√© Entrep√¥t</th>
        </tr>
      </thead>

      <tbody>
        {% for item in commandes %}
        <tr {% if item.qte_restante == 0 %}class="table-success"{% endif %}>
          <td>{{ forloop.counter }}</td>
          <td>{{ item.commande.numcmd }}</td>
          <td>{{ item.commande.produits.desgprod }}</td>
          <td>{{ item.commande.nom_complet_fournisseur }}</td>
          <td>{{ item.commande.qtecmd }}</td>
          <td><span class="badge bg-info">{{ item.total_livree }}</span></td>
          <td>
            <span class="badge {% if item.qte_restante == 0 %}bg-success{% else %}bg-warning text-dark{% endif %}">
              {{ item.qte_restante }}
            </span>
          </td>

          {% if item.qte_restante > 0 %}
          <td>
            <select name="destination[]" class="form-select">
              <option value="MAGASIN">Magasin</option>
              <option value="ENTREPOT">Entrep√¥t</option>
              <option value="DEUX">Les deux</option>
            </select>
          </td>

          <td>
            <input type="number" name="qte_magasin[]" class="form-control" min="0" max="{{ item.qte_restante }}" value="0">
          </td>
          <td>
            <input type="number" name="qte_entrepot[]" class="form-control" min="0" max="{{ item.qte_restante }}" value="{{ item.qte_restante }}">
          </td>

          <input type="hidden" name="commande_id[]" value="{{ item.commande.id }}">
          {% else %}
          <td colspan="3" class="text-success fw-bold text-center">‚úî Livraison compl√®te</td>
          {% endif %}
        </tr>
        {% empty %}
        <tr>
          <td colspan="10" class="text-center text-muted">Aucune commande √† r√©ceptionner</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if commandes %}
  <div class="mt-3">
    <button type="submit" class="btn btn-success">üíæ Enregistrer la livraison</button>
  </div>
  {% endif %}
</form>

{% endblock %}
