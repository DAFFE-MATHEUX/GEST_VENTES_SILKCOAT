{% extends 'admin.html' %}
{% load static %}
{% block contents %}
<style>
    .table-responsive {
        overflow-x: auto;
        width: 100%;
    }
    .table td, .table th {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 200px;
    }
    .table img {
        max-width: 60px;
        max-height: 60px;
        object-fit: contain;
    }
    body {
        overflow-x: hidden;
    }
</style>

<div class="container">
    <h2>Historique des Commandes et Livraisons</h2>
    <br>

    {% if historique %}
        <div class="table-responsive">
             <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Num Commande</th>
                    <th>Produit</th>
                    <th>Catégorie</th>
                    <th>Qte Commandée</th>
                    <th>Total Livrée</th>
                    <th>Qte Restante</th>
                    <th>Livraisons</th>
                </tr>
            </thead>
            <tbody>
                {% for item in historique %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ item.commande.numcmd }}</td>
                    <td>{{ item.commande.produits.desgprod }}</td>
                    <td>{{ item.commande.produits.categorie.desgcategorie }}</td>
                    <td>{{ item.commande.qtecmd }}</td>
                    <td>{{ item.total_livree }}</td>
                    <td>{{ item.qte_restante }}</td>
                    <td>
                        {% if item.livraisons %}
                            <ul>
                                {% for liv in item.livraisons %}
                                    <li>
                                        {{ liv.datelivrer|date:"d/m/Y" }} : {{ liv.qtelivrer }} unité(s)
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            Aucune livraison
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        </div>
       
    {% else %}
        <p>Aucune commande ou livraison enregistrée.</p>
    {% endif %}
</div>

{% endblock %}
