{% extends 'admin.html' %}
{% block contents %}

<h2>Ajouter du Stock Ã  Plusieurs Produits</h2>

{% if messages %}
    {% for mgs in messages %}
        <div class="alert 
            {% if mgs.tags == 'success' %} alert-success
            {% elif mgs.tags == 'error' %} alert-danger
            {% else %} alert-info
            {% endif %}">
            {{ mgs }}
        </div>
    {% endfor %}
{% endif %}

<form method="post">
    {% csrf_token %}

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Produit</th>
                <th>QuantitÃ© Ã  ajouter</th>
                <th>Seuil dâ€™alerte</th>
            </tr>
        </thead>

        <tbody>
            {% for p in produits %}
            <tr>
                <td>
                    <strong>{{ p.refprod }}</strong> â€“ {{ p.desgprod }}
                    <input type="hidden" name="produit[]" value="{{ p.id }}">
                </td>

                <td>
                    <input type="text"
                           name="qtestock[]"
                           class="form-control input-number"
                           value="0"
                           required>
                </td>

                <td>
                    <input type="text"
                           name="seuil[]"
                           class="form-control input-number"
                           value="0"
                           required>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <button type="submit" class="btn btn-primary mt-3">
        ðŸ’¾ Enregistrer les stocks
    </button>
</form>

<script>
// Bloquer les caractÃ¨res non numÃ©riques pour tous les champs avec class input-number
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('.input-number');
    inputs.forEach(input => {
        input.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    });
});

// Disparition des messages aprÃ¨s 4 secondes
setTimeout(function() {
    let messages = document.querySelectorAll('.alert');
    messages.forEach(function(el) {
        el.style.transition = "opacity 0.5s";
        el.style.opacity = "0";
        setTimeout(() => el.remove(), 500);
    });
}, 4000);
</script>

{% endblock %}
