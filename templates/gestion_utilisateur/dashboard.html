{% extends "admin.html" %}
{% load static %}

{% block contents %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- ===========================
     PAGE D'ACCUEIL ADMINISTRATION
     =========================== -->
<section class="content-header">
    {% if not request.user.type_utilisateur == 'Gerante' %} 
        <h1>TABLEAU DE BORD D'ADMINISTRATION</h1>
    {% else %} 
        <h1>BIENVENUE DANS VOTRE ESPACE</h1>
    {% endif %}
    <ol class="breadcrumb">
        <li>
            <a href="{% url 'gestionUtilisateur:tableau_bord' %}">
                <i class="fa fa-dashboard"></i> Home
            </a>
        </li>
        <li class="active">Dashboard</li>
    </ol>
</section>

<!-- ===========================
     CONTENU PRINCIPAL
     =========================== -->
<section class="content">

<!-- =====================
     BO√éTES DE STATISTIQUES
     ===================== -->
<div class="row">

    <div class="col-lg-3 col-xs-6">
        <div class="small-box bg-green">
            <div class="inner">
                <h3>{{ total_categories }}</h3>
                <p>Total Cat√©gories Produit</p>
            </div>
            <div class="icon"><i class="ion ion-pricetags"></i></div>
            <a href="{% url 'produits:listes_categorie' %}" class="small-box-footer">
                Voir Plus <i class="fa fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>

    <div class="col-lg-3 col-xs-6">
        <div class="small-box bg-aqua">
            <div class="inner">
                <h3>{{ total_produits }}</h3>
                <p>Total Produits</p>
            </div>
            <div class="icon"><i class="ion ion-cube"></i></div>
            <a href="{% url 'produits:listes_produits' %}" class="small-box-footer">
                Voir Plus <i class="fa fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>

    <!-- ‚úÖ STOCK TOTAL -->
    <div class="col-lg-3 col-xs-6">
        <div class="small-box bg-red">
            <div class="inner">
                <h3>{{ total_stock }}</h3>
                <p>Stock Total</p>
            </div>
            <div class="icon"><i class="ion ion-cube"></i></div>
            <a href="{% url 'produits:listes_produits_stock' %}" class="small-box-footer">
                Voir Plus <i class="fa fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
        <div class="col-lg-3 col-xs-6">
        <div class="small-box bg-red">
            <div class="inner">
                <h3>{{ total_ventes }}</h3>
                <p>Ventes (Semaine)</p>
            </div>
            <div class="icon"><i class="ion ion-cash"></i></div>
            <a href="{% url 'produits:listes_des_ventes' %}" class="small-box-footer">
                Voir Plus <i class="fa fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>

</div>

<!-- =====================
     COMMANDES / LIVRAISONS 
     ===================== -->
<div class="row">

    <div class="col-lg-3 col-xs-6">
        <div class="small-box bg-yellow">
            <div class="inner">
                <h3>{{ total_commandes }}</h3>
                <p>Commandes (Semaine)</p>
            </div>
            <div class="icon"><i class="ion ion-bag"></i></div>
            <a href="{% url 'produits:listes_des_commandes' %}" class="small-box-footer">
                Voir Plus <i class="fa fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>

    <div class="col-lg-3 col-xs-6">
        <div class="small-box bg-yellow">
            <div class="inner">
                <h3>{{ total_livraisons }}</h3>
                <p>Livraisons (Semaine)</p>
            </div>
            <div class="icon"><i class="ion ion-bag"></i></div>
            <a href="{% url 'produits:listes_des_livraisons' %}" class="small-box-footer">
                Voir Plus <i class="fa fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>


</div>
<!-- =====================
     5 DERNI√àRES VENTES
     ===================== -->
<div class="row">
    <div class="col-md-12">
        <div class="box box-info">
            <div class="box-header with-border">
                <h3 class="box-title">5 Derni√®res Ventes</h3>
            </div>
            <div class="box-body table-responsive">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Code Vente</th>
                            <th>R√©f√©rence</th>
                            <th>Produit</th>
                            <th>Date</th>
                            <th>Qt√©</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vente in dernieres_ventes %}
                            {% for ligne in vente.lignes.all %}
                            <tr>
                                <td>{{ forloop.parentloop.counter }}.{{ forloop.counter }}</td>
                                <td>{{ vente.code }}</td>
                                <td>{{ ligne.produit.refprod }}</td>
                                <td>{{ ligne.produit.desgprod }}</td>
                                <td>{{ vente.date_vente|date:"d/m/Y H:i" }}</td>
                                <td>{{ ligne.quantite }}</td>
                                <td>{{ vente.total|floatformat:0 }} GNF</td>
                            </tr>
                            {% endfor %}
                        {% empty %}
                            <tr>
                                <td colspan="7" class="text-center">Aucune vente r√©cente</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- =====================
     TOP 5 PRODUITS RENTABLES
     ===================== -->
<div class="row">
    <div class="col-md-12">
        <div class="box box-warning">
            <div class="box-header with-border">
                <h3 class="box-title">üí∞ TOP 5 PRODUITS LES PLUS RENTABLES</h3>
            </div>
            <div class="box-body table-responsive">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>R√©f</th>
                            <th>Cat√©gorie</th>
                            <th>Produit</th>
                            <th>Qt√©</th>
                             {% if request.user.type_utilisateur != 'Gerante' %}
                            <th>B√©n√©fice</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in top_produits_rentables %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ p.produit__refprod }}</td>
                            <td>{{ p.produit__categorie__desgcategorie }}</td>
                            <td>{{ p.produit__desgprod }}</td>
                            <td>{{ p.qte_vendue }}</td>
                             {% if request.user.type_utilisateur != 'Gerante' %}
                            <td class="text-success">
                                <strong>{{ p.benefice_total|floatformat:0 }} GNF</strong>
                            </td>
                            {% endif %}
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center">Aucune donn√©e disponible</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- =====================
     GRAPHIQUES
     ===================== -->
<div class="row">
    <div class="col-md-6">
        <div class="box box-success">
            <div class="box-header with-border">
                <h3 class="box-title">üìä Produits les plus vendus</h3>
            </div>
            <div class="box-body">
                <canvas id="chartTopProduits"></canvas>
            </div>
        </div>
    </div>
 {% if request.user.type_utilisateur != 'Gerante' %}
    <div class="col-md-6">
        <div class="box box-success">
            <div class="box-header with-border">
                <h3 class="box-title">üìä Rentabilit√©</h3>
            </div>
            <div class="box-body">
                <canvas id="chartRentabilite"></canvas>
            </div>
        </div>
    </div>
    {% endif %}
</div>

</section>

<!-- =====================
     SCRIPTS CHARTS
     ===================== -->
<script>
new Chart(document.getElementById('chartTopProduits'), {
    type: 'bar',
    data: {
        labels: {{ labels_produits|safe }},
        datasets: [{
            label: 'Quantit√© vendue',
            data: {{ quantites_produits|safe }},
            backgroundColor: 'rgba(54,162,235,0.7)'
        }]
    },
    options: { responsive: true }
});
</script>

<script>
new Chart(document.getElementById('chartRentabilite'), {
    type: 'bar',
    data: {
        labels: {{ labels_rentables|safe }},
        datasets: [{
            label: 'B√©n√©fice (GNF)',
            data: {{ benefices|safe }},
            backgroundColor: 'rgba(40,167,69,0.7)'
        }]
    },
    options: { responsive: true }
});
</script>

{% endblock %}
